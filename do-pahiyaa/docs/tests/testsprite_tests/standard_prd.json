{
  "meta": {
    "project": "Superbike Marketplace (SaaS Command Center)",
    "date": "2026-02-15",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A lead-first marketplace for buying and selling bikes with role-based authentication for Buyers and Dealers, searchable city-filtered listings, dealer lead management, and a credits-based billing flow powered by Razorpay.",
  "core_goals": [
    "Enable buyers to discover and inquire about verified bike listings quickly with robust search and city filters.",
    "Provide dealers with a dashboard to manage inventory, view and unlock leads, and monitor subscription/credit status.",
    "Monetize lead access through a credits system and Razorpay payments with reliable server-side order handling.",
    "Offer secure, role-based authentication (Buyer/Dealer) and smooth listing creation flows for sellers.",
    "Surface realtime lead activity and actionable dealer workflows while maintaining clear error handling and UX states."
  ],
  "features": [
    {
      "name": "Authentication",
      "description": "Sign up and log in users with role selection (Buyer or Dealer) using Supabase Auth, protecting role-restricted routes via middleware.",
      "user_flows": [
        "Navigate to /auth/signup -> Select role: Dealer -> Fill name field -> Fill email field -> Fill password field -> Click Create account button -> See dealer onboarding or /dealer/dashboard",
        "Navigate to /auth/login -> Fill email field -> Fill password field -> Click Login button -> See home page or /dealer/dashboard depending on role",
        "Navigate to /auth/signup -> Select role: Buyer -> Fill email field -> Fill password field -> Click Create account button -> See home page",
        "Navigate to /auth/login -> Fill email field with unknown account -> Fill password field -> Click Login button -> See error message 'User not found' or prompt to sign up",
        "Navigate to /auth/signup -> Fill email field with already-registered email -> Fill password field -> Click Create account button -> See error toast 'Email already in use'"
      ]
    },
    {
      "name": "Marketplace Listings",
      "description": "Browse, search, filter by city, and sort bike listings; view detailed listing pages with lead capture options.",
      "user_flows": [
        "Navigate to / -> See list of ListingCards -> Use search input on page -> Enter search keywords -> Press Search -> See filtered results",
        "Navigate to /search -> Use city filter control -> Select city -> Use sort control -> Select 'Newest' -> See sorted results for selected city",
        "Navigate to / -> Click a ListingCard -> Navigate to /listings/{id} -> See listing details and images",
        "Navigate to /search -> Enter query that matches no results -> Click Search -> See Empty State with 'No Results' message",
        "Navigate to / -> Apply city filter -> Apply incompatible filter combination -> See filtered results count '0' and offer to broaden filters"
      ]
    },
    {
      "name": "Dealer Dashboard",
      "description": "Dealer-facing dashboard to view inventory, stats, recent leads, and subscription/credits status; provides quick actions for listings and leads.",
      "user_flows": [
        "Navigate to /auth/login -> Login as Dealer -> Redirected to /dealer/dashboard -> See DealerStats component with revenue and credit balance",
        "Navigate to /dealer/dashboard -> See RecentLeads list -> Click a lead item -> Open lead detail in dashboard -> See lead metadata",
        "Navigate to /dealer/dashboard -> Select multiple listings via row selection -> See floating bulk action bar -> Click Bulk Edit -> See quick edit drawer",
        "Navigate to /dealer/dashboard as non-dealer user -> Attempt to access page -> Middleware redirects to /auth/login or shows 403 unauthorized",
        "Navigate to /dealer/dashboard -> Select a lead -> Click Unlock lead -> If credits insufficient see Buy Credits modal instead of contact details"
      ]
    },
    {
      "name": "Lead Management",
      "description": "Buyers can inquire on listings and dealers can unlock leads using credits; unlocking is handled by /api/leads/unlock and subject to role and credit checks.",
      "user_flows": [
        "Navigate to /listings/{id} -> Click Inquire button -> Fill inquiry message field -> Click Send Inquiry -> See confirmation 'Inquiry sent' and notification sent to dealer",
        "Navigate to /dealer/dashboard -> Open RealtimeLeadsList -> Click a new lead -> Click Unlock lead button -> Call /api/leads/unlock -> Receive buyer contact details -> See lead marked as unlocked",
        "Navigate to /dealer/dashboard -> Click Unlock lead -> Call /api/leads/unlock -> Server responds with insufficient credits -> See Buy Credits modal prompting purchase",
        "Navigate to /dealer/dashboard -> Click Unlock lead for a lead that is already unlocked by another dealer -> Call /api/leads/unlock -> See error 'Lead already claimed' and lead remains locked"
      ]
    },
    {
      "name": "Listing Creation",
      "description": "Sellers and dealers can create new bike listings via a structured form with image upload and required fields at /seller/listings/new.",
      "user_flows": [
        "Navigate to /seller/listings/new -> Fill title field -> Fill price field -> Select city -> Upload images -> Click Publish -> See confirmation and redirect to newly created /listings/{id}",
        "Navigate to /seller/listings/new -> Leave required field blank -> Click Publish -> See inline validation error for the missing field",
        "Navigate to /seller/listings/new -> Upload an unsupported file type -> File upload fails -> See error 'Unsupported file type' and image not attached",
        "Navigate to /seller/listings/new as non-authenticated user -> Attempt to access page -> Middleware redirects to /auth/login"
      ]
    },
    {
      "name": "Billing & Credits",
      "description": "Dealers purchase lead credits via a Razorpay-backed flow; orders are created at /api/billing/order and payment status updates credits on success.",
      "user_flows": [
        "Navigate to /dealer/dashboard -> Open Buy Credits modal -> Select credits package -> Click Buy -> Client calls /api/billing/order -> Razorpay widget opens -> Complete payment -> Server confirms payment -> See updated credit balance on dashboard",
        "Navigate to /dealer/dashboard -> Open Buy Credits modal -> Select credits package -> Click Buy -> Client calls /api/billing/order -> Razorpay payment fails or is cancelled -> See payment failure toast and option to retry",
        "Navigate to /dealer/dashboard with expired subscription -> Click Buy Credits -> Create order via /api/billing/order -> Complete payment -> See subscription/credits updated and success notification",
        "Navigate to Buy Credits modal -> Select package -> Click Buy -> Client fails to create order due to server error -> See error 'Unable to create order' and remain on modal"
      ]
    }
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js",
      "Supabase",
      "Tailwind CSS",
      "Shadcn UI",
      "Razorpay"
    ],
    "features": [
      {
        "name": "Authentication",
        "description": "User signup and login with role selection (Buyer/Dealer) using Supabase Auth.",
        "files": [
          "src/app/auth/login/page.tsx",
          "src/app/auth/signup/page.tsx",
          "src/middleware.ts",
          "src/lib/services/auth.service.ts"
        ]
      },
      {
        "name": "Marketplace Listings",
        "description": "View, search, and filter bike listings. Supports city-wise filtering and sorting.",
        "files": [
          "src/app/page.tsx",
          "src/app/search/page.tsx",
          "src/app/listings/[id]/page.tsx",
          "src/components/marketplace/ListingCard.tsx",
          "src/lib/services/listing.service.ts"
        ]
      },
      {
        "name": "Dealer Dashboard",
        "description": "Dashboard for dealers to manage inventory, view leads, and check subscription status.",
        "files": [
          "src/app/dealer/dashboard/page.tsx",
          "src/components/dealer/DealerStats.tsx",
          "src/components/dealer/RecentLeads.tsx",
          "src/lib/services/dealer.service.ts"
        ]
      },
      {
        "name": "Lead Management",
        "description": "System for buyers to inquire and dealers to unlock leads using credits.",
        "files": [
          "src/app/api/leads/unlock/route.ts",
          "src/components/dealer/RealtimeLeadsList.tsx",
          "src/lib/services/lead.service.ts"
        ]
      },
      {
        "name": "Listing Creation",
        "description": "Form for dealers/sellers to post new bike listings with details and images.",
        "files": [
          "src/app/seller/listings/new/page.tsx",
          "src/components/seller/ListingForm.tsx"
        ]
      },
      {
        "name": "Billing & Credits",
        "description": "Razorpay integration for purchasing lead credits.",
        "files": [
          "src/app/api/billing/order/route.ts",
          "src/components/dealer/BuyCreditsModal.tsx",
          "src/lib/services/billing.service.ts"
        ]
      }
    ]
  }
}
