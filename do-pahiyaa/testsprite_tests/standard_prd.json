{
  "meta": {
    "project": "SaaS Command Center",
    "date": "2026-02-21",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "A high-performance admin interface and backend suite for a lead-first marketplace: a keyboard-driven, visually rich admin panel combined with secure admin auth, lead monetization, payment webhooks and a fast public marketplace search.",
  "core_goals": [
    "Enable fast, keyboard-first administration workflows (Cmd+K command palette) for operators to perform common actions without context switching.",
    "Provide a \"God Mode\" dashboard with real-time metrics and event feed for operational visibility.",
    "Implement secure, role-validated admin authentication and RLS-backed service layer for leads and listings.",
    "Monetize lead access via a reliable Lead Unlock Engine that deducts dealer credits and protects contact data.",
    "Automate payments and credit top-ups via webhook processing (Razorpay) with robust verification and reconciliation.",
    "Deliver a fast, filterable public marketplace search with dynamic filters and graceful error handling.",
    "Polish brand/UX through a theme overhaul, toast notifications, confirmation dialogs and empty states."
  ],
  "features": [
    {
      "name": "Global Command Palette (Cmd+K)",
      "description": "Keyboard-driven modal for navigation and one-shot actions (e.g., Approve Listing, Ban User, Switch Theme, Search). Accessible from anywhere in the admin interface.",
      "user_flows": [
        "POST /api/auth/admin/login with valid credentials -> Receive 200 with JWT token -> POST /api/commands/execute with Authorization: Bearer token and body {\"command\":\"Approve Listing\",\"listingId\":\"lst_123\"} -> Receive 200 action acknowledged -> GET /api/listings?q=&listingId=lst_123 with Authorization: Bearer token -> Receive 200 listing object with status approved",
        "POST /api/commands/execute without Authorization header -> Receive 401 Unauthorized"
      ]
    },
    {
      "name": "God Mode Dashboard",
      "description": "High-density admin dashboard with revenue area charts, user activity heatmap and a live event feed (WebSocket or polling fallback) for platform monitoring.",
      "user_flows": [
        "POST /api/auth/admin/login with valid credentials -> Receive 200 with JWT token -> GET /api/dashboard/metrics with Authorization: Bearer token -> Receive 200 JSON containing revenue_series and user_activity -> GET /api/dashboard/livefeed?since=ts with Authorization: Bearer token -> Receive 200 JSON array of recent events",
        "GET /api/dashboard/metrics with expired/invalid token -> Receive 401 Unauthorized"
      ]
    },
    {
      "name": "Data Management (Advanced Tables)",
      "description": "TanStack-style table views for listings/users/leads with sticky headers, multi-row selection, bulk actions and a Quick Look drawer to edit rows inline.",
      "user_flows": [
        "POST /api/auth/admin/login with valid credentials -> Receive 200 with JWT token -> GET /api/listings?limit=50&sort=created_at with Authorization: Bearer token -> Receive 200 listings page -> POST /api/listings/bulk with Authorization: Bearer token and body {\"action\":\"delete\",\"ids\":[\"lst_1\",\"lst_2\"]} -> Receive 200 bulk action result",
        "POST /api/listings/bulk with Authorization: Bearer token and body {\"action\":\"delete\",\"ids\":[]} -> Receive 400 Bad Request"
      ]
    },
    {
      "name": "Theme Overhaul â€” \"Superbike Orange\"",
      "description": "Brand refresh: primary color palette update and admin-side theme toggle persisted to settings so all admins get the new Superbike Orange experience.",
      "user_flows": [
        "POST /api/auth/admin/login with valid credentials -> Receive 200 with JWT token -> POST /api/admin/settings/theme with Authorization: Bearer token and body {\"theme\":\"superbike_orange\"} -> Receive 200 updated settings",
        "POST /api/admin/settings/theme with Authorization: Bearer token and body {\"theme\":\"unsupported_value\"} -> Receive 422 Unprocessable Entity"
      ]
    },
    {
      "name": "Toast Notifications & Confirmation Dialogs",
      "description": "Non-blocking toast system for success/error feedback and reusable confirmation modals for destructive actions (e.g., Ban User, Delete Listing).",
      "user_flows": [
        "POST /api/auth/admin/login with valid credentials -> Receive 200 with JWT token -> DELETE /api/users/user_789 with Authorization: Bearer token and header X-Confirmed:true -> Receive 200 deletion acknowledged -> GET /api/notifications/latest with Authorization: Bearer token -> Receive 200 with toast entry {\"type\":\"success\",\"message\":\"User banned\"}",
        "DELETE /api/users/user_789 with Authorization: Bearer token and no confirmation header -> Receive 403 Forbidden"
      ]
    },
    {
      "name": "Admin Auth",
      "description": "Secure authentication endpoint for administrators with email-based login and custom role validation to gate admin-only actions.",
      "user_flows": [
        "POST /api/auth/admin/login with valid admin email and password -> Receive 200 with JWT token (role: admin)",
        "POST /api/auth/admin/login with invalid credentials -> Receive 401 Unauthorized"
      ]
    },
    {
      "name": "Lead Unlock Engine",
      "description": "Monetization core: dealers spend credits to unlock buyer contact information; server enforces RLS and decrements credits atomically.",
      "user_flows": [
        "POST /api/leads/unlock?leadId=lead_abc123 with Authorization: Bearer dealer_token -> Receive 200 with contact_info and remaining_credits",
        "POST /api/leads/unlock?leadId=lead_abc123 with Authorization: Bearer dealer_token when dealer has 0 credits -> Receive 402 Insufficient Credits"
      ]
    },
    {
      "name": "Payment Webhooks (Razorpay)",
      "description": "Webhook endpoint to process Razorpay payment events for automated credit top-ups and subscription lifecycle updates. Verifies signatures and updates dealer balances/subscriptions.",
      "user_flows": [
        "POST /api/webhooks/razorpay with valid Razorpay event payload and valid X-Razorpay-Signature header -> Receive 200 Acknowledge -> GET /api/dealers/dealer_456/credits with Authorization: Bearer system_token -> Receive 200 with updated balance reflecting the top-up",
        "POST /api/webhooks/razorpay with invalid/missing signature header -> Receive 400 Bad Request"
      ]
    },
    {
      "name": "Marketplace Search",
      "description": "Public-facing listing search with dynamic filters (brand, city, price range, full-text q) and paginated results optimized for quick discovery.",
      "user_flows": [
        "GET /api/listings?q=Royal+Enfield&brand=Royal+Enfield&city=Delhi&price_max=150000 -> Receive 200 with listings array and pagination metadata",
        "GET /api/listings?price_max=not_a_number -> Receive 422 Unprocessable Entity"
      ]
    }
  ],
  "code_summary": {
    "tech_stack": [
      "TypeScript",
      "Next.js",
      "Supabase",
      "Tailwind CSS",
      "Zod"
    ],
    "features": [
      {
        "name": "Admin Auth",
        "description": "Secure authentication for system administrators using email and custom role validation.",
        "files": [
          "src/app/api/auth/admin/login/route.ts",
          "src/lib/auth/authorization.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/auth/admin/login": {
              "post": {
                "summary": "Admin Login",
                "responses": {
                  "200": {
                    "description": "Success"
                  },
                  "401": {
                    "description": "Unauthorized"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Lead Unlock Engine",
        "description": "Monetization core: Deducts dealer credits to unlock direct buyer contact info.",
        "files": [
          "src/app/api/leads/unlock/route.ts",
          "src/lib/services/lead.service.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/leads/unlock": {
              "post": {
                "summary": "Unlock Lead",
                "parameters": [
                  {
                    "name": "leadId",
                    "in": "query",
                    "required": true,
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Unlocked"
                  },
                  "402": {
                    "description": "Insufficient Credits"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Payment Webhooks",
        "description": "Razorpay webhook integration for automated credit top-ups and subscription updates.",
        "files": [
          "src/app/api/webhooks/razorpay/route.ts"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/webhooks/razorpay": {
              "post": {
                "summary": "Process Razorpay Payment",
                "responses": {
                  "200": {
                    "description": "Acknowledge"
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Marketplace Search",
        "description": "Public bike listings search with dynamic filters (Brand, City, Price).",
        "files": [
          "src/app/api/listings/route.ts",
          "src/components/search/SearchClient.tsx"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "paths": {
            "/api/listings": {
              "get": {
                "summary": "Search Listings",
                "parameters": [
                  {
                    "name": "q",
                    "in": "query",
                    "schema": {
                      "type": "string"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Listings Data"
                  }
                }
              }
            }
          }
        }
      }
    ]
  }
}
